{% extends "auctions/layout.html" %}
{% block title %}{{ listing.title }}{% endblock %}

{% block style %}<style>
    .container {
        background-color: white;
    }

    .listing-img {
        width: 100%;
        object-fit: cover;
    }

    .btn {
        width: 100%;
    }

    .bid {
        font-size: 0.8rem;
    }
</style>{% endblock %}
{% block content %}
<div class="row justify-content-center gy-2">
    <!-- Left(listing) container -->
    <div class="col-12 col-sm-12 col-md-12 col-lg-8 col-xl-6">
        <div class="container border rounded-4 shadow-sm px-4 pt-4 pb-0" style="word-wrap: break-word;">
            <h3 class="mp-darkblue">{{ listing.title }}</h3>
            <div class="row py-2">
                <!-- left column(image) -->
                <div class="col-12 col-sm-12 col-md-7 col-lg-8">

                    {% if listing.image_url %}
                    <img src="{{ listing.image_url }}" alt="Listing image" class="listing-img"
                        onerror="this.src='{{ placeholder_img }}'"></a>
                    {% else %}
                    <img src="{{ placeholder_img }}" alt="Listing image" class="listing-img"></a>
                    {% endif %}
                </div>

                <!-- Right column(info) -->
                <div class="col-12 col-sm-12 col-md-4">

                    <!-- Watchlist buttons -->
                    {% if user.is_authenticated and user != listing.user %}
                    <div class="row pb-4 pt-2 pt-sm-2">
                        <form action="{% url 'listing' listing.pk %}" method="post">
                            {% csrf_token %}

                            {% if not on_watchlist %}
                            <input class="btn btn-success btn-watchlist" name="add_watchlist" type="submit"
                                value="+ Add to watchlist">
                            {% else %}
                            <input class="btn btn-danger btn-watchlist" name="rm_watchlist" type="submit"
                                value="- Remove from watchlist">
                            {% endif %}

                        </form>
                    </div>
                    {% endif %}

                    <!-- Listing info -->
                    <div class="row pt-2 pt-sm-0">
                        <h5 class="mp-lightblue">Current price</h5>
                        <p style="font-size:1.5rem;">€{{ listing.highest_bid|floatformat:2 }}</p>
                    </div>
                    <div class="row">
                        <h6 class="mp-lightblue">Sold by</h6>
                        {% if user == listing.user %}
                        <p style="color:green;">You</p>
                        {% else %}
                        <p>{{ listing.user|truncatechars:20 }}</p>
                        {% endif %}
                    </div>
                    <div class="row">
                        <h6 class="mp-lightblue">Auctioned since</h6>
                        <p>{{ listing.date|date:"d F Y"}}</p>
                    </div>
                </div>
            </div>

            <!-- Listing description -->
            <div class="row">
                <h6 class="mp-lightblue">Description</h6>
                <p>{{ listing.description|linebreaksbr }}</p>
            </div>
        </div>
    </div>
    <!-- Right(bid) container -->
    <div class="col-12 col-sm-12 col-md-12 col-lg-4 col-xl-3">
        <div class="container border rounded-4 shadow-sm p-4" style="word-wrap: break-word;">
            <h5>Bids</h5>

            <!-- Form to place bid -->
            <p>
            {% if user.is_authenticated and user != listing.user %}
            
                {% load django_bootstrap5 %}
            <form action="{% url 'listing' listing.pk %}" method="post">
                {% csrf_token %}
                {% bootstrap_field form.amount show_label=False addon_before="€"%}
                {% bootstrap_button "Place bid" button_type="submit" button_class="btn-primary" name="place_bid" %}
            </form>
            {% elif not user.is_authenticated %}
            <a href="{% url 'login' %}" class="mp-link">Log in</a> to bid on this item.
            {% endif %}
            </p>

            <!-- Top bids -->
            {% if bids %}
                {% for bid in bids %}
                <hr>
                <div class="row bid">
                    <div class="col-7">{{ bid.user|truncatechars:20 }}</div> 
                    <div class="col-5">€{{ bid.amount|floatformat:2 }}</div>
                </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</div>



{% endblock %}